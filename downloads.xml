<?xml version="1.0" encoding="utf-8"?>
<dleplugin>
	<name>Downloads</name>
	<description>Sitenize yüklediğiniz dosyaların ayrı sayfada indirilmesini sağlayabilirsiniz</description>
	<icon>engine/skins/images/downloads.png</icon>
	<version>1.7</version>
	<dleversion>13.0</dleversion>
	<versioncompare>greater</versioncompare>
	<upgradeurl>https://raw.githubusercontent.com/dlenettr/downloads/master/release.json</upgradeurl>
	<filedelete>1</filedelete>
	<mysqlinstall><![CDATA[INSERT INTO {prefix}_admin_sections (name, icon, title, descr, allow_groups) VALUES ('download', 'engine/skins/images/downloads.png', 'Downloads v1.7', 'Sitenize yüklediğiniz dosyaların ayrı sayfada indirilmesini sağlayabilirsiniz', '1')]]></mysqlinstall>
	<mysqlupgrade><![CDATA[]]></mysqlupgrade>
	<mysqlenable><![CDATA[]]></mysqlenable>
	<mysqldisable><![CDATA[DELETE FROM {prefix}_admin_sections WHERE name = 'download';]]></mysqldisable>
	<mysqldelete><![CDATA[DELETE FROM {prefix}_admin_sections WHERE name = 'download';]]></mysqldelete>
	<file name="engine/engine.php">
		<operation action="before">
			<searchcode><![CDATA[case "changemail" :]]></searchcode>
			<replacecode><![CDATA[// Downloads
	case "downloads" :
		include ENGINE_DIR . '/modules/download.php';
		break;
// Downloads]]></replacecode>
		</operation>
		<operation action="after">
			<searchcode><![CDATA[elseif ($do == 'tags') $nam_e = stripslashes($tag);]]></searchcode>
			<replacecode><![CDATA[// Downloads
elseif ($do == 'download') {
	$nam_e = $dset['name'];
	$titl_e = $dset['title'];
	$metatags['header_title'] = $dset['header_title'];
}
// Downloads]]></replacecode>
		</operation>
	</file>
	<file name="engine/modules/functions.php">
		<operation action="before">
			<searchcode><![CDATA[$story = str_replace ( $find_1, $replace_1, $story );]]></searchcode>
			<replacecode><![CDATA[// Downloads
	include ENGINE_DIR . "/modules/download.func.php";
// Downloads]]></replacecode>
		</operation>
		<operation action="replace">
			<searchcode><![CDATA[global $db, $config, $lang, $user_group, $member_id, $_TIME, $news_date;]]></searchcode>
			<replacecode><![CDATA[global $db, $config, $lang, $user_group, $member_id, $_TIME, $news_date, $file_names;]]></replacecode>
		</operation>
		<operation action="after">
			<searchcode><![CDATA[$find_2[] = "#\[attachment={$row['id']}:(.+?)\]#i";]]></searchcode>
			<replacecode><![CDATA[$file_names[ $row['id'] ] = $db->safesql( $row['name'] );]]></replacecode>
		</operation>
	</file>
</dleplugin>